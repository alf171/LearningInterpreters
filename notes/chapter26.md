# Chatper 25 - Closures

- right now a function has no way to reference a variable outside of its scope
  - except for global variables that is
- before we thought of variables as having stack semantics
  - variables are discared in the reverse order they are created
- closure doesn't totally follow
- jlox solves this by allocating memory for all local variables -- envs
- throw it all on the heap but we are using the stack
- new approach
  - for locals without closure, keep on stack
  - when local is captured in closure, move them onto heap so they can live longer
  - this design comes from the Lua VM
  - not much code and pretty fast
  - suited for single pass compiler
- Closure objects
  - before we treated functions like strings, or other literals
  - the issue is that closure can't have this
  - consider a function which returns a function
    - if called twice, it must hold some representation inside
    - otherwise they would need same output
